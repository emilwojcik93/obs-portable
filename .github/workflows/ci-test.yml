name: üß™ Continuous Integration Test

on:
  push:
    branches: [ main ]
    paths: 
      - 'Deploy-OBSStudio.ps1'
      - '.github/workflows/ci-test.yml'
      - '.github/scripts/*.ps1'
  pull_request:
    branches: [ main ]
    paths:
      - 'Deploy-OBSStudio.ps1'
      - '.github/workflows/ci-test.yml'
      - '.github/scripts/*.ps1'
  workflow_dispatch:
    # Allow manual triggering for testing

jobs:
  test:
    runs-on: windows-2025
    
    steps:
    - name: üîÑ Checkout Repository
      uses: actions/checkout@v4

    - name: üß™ Test Script Syntax
      shell: pwsh
      run: powershell -ExecutionPolicy Bypass -File .github/scripts/test-script-syntax.ps1 -ScriptPath ".\Deploy-OBSStudio.ps1"

    - name: üîç Test CheckOnly Mode
      shell: pwsh
      run: powershell -ExecutionPolicy Bypass -File .github/scripts/test-checkonly-mode.ps1 -ScriptPath ".\Deploy-OBSStudio.ps1" -PerformanceMode 60

    - name: üéõÔ∏è Test Performance Mode Parameters
      shell: pwsh
      run: powershell -ExecutionPolicy Bypass -File .github/scripts/test-performance-modes.ps1 -ScriptPath ".\Deploy-OBSStudio.ps1"

    - name: üìã Test Help Documentation
      shell: pwsh
      run: powershell -ExecutionPolicy Bypass -File .github/scripts/test-help-documentation.ps1 -ScriptPath ".\Deploy-OBSStudio.ps1"

    - name: ‚úÖ CI Test Summary
      shell: pwsh
      run: |
        Write-Host "=== CI Test Summary ===" -ForegroundColor Green
        Write-Host "+ Script syntax validation passed" -ForegroundColor Green
        Write-Host "+ CheckOnly mode functionality verified" -ForegroundColor Green
        Write-Host "+ All performance modes tested successfully" -ForegroundColor Green
        Write-Host "+ Help documentation accessible" -ForegroundColor Green
        Write-Host ""
        Write-Host "Deploy-OBSStudio.ps1 is ready for deployment!" -ForegroundColor Green
